<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>知识点浏览</title>
  <style>
    /* 页面整体样式 */
    body, html {
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
      font-family: "Microsoft Yahei", sans-serif;
      background: #f8f9fa;
      color: #333;
    }
    #container {
      height: 100vh;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
    }

    /* 大类标题 */
    .category-title {
      font-size: 1.5em;
      margin: 30px 15px 20px;
      font-weight: bold;
      color: #222;
    }

    /* 不同类别的背景色 */
    .category-0 .knowledge-item { background: #e1feff42; }
    .category-1 .knowledge-item { background: #ffd8b921; }
    .category-2 .knowledge-item { background: #e1ffca45; }
    /* 可按需继续添加更多颜色 */

    .knowledge-item {
  padding: 20px 16px;
  margin: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  color: #000000;
  user-select: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: background-color 0.3s ease;

  white-space: normal;       /* 允许自动换行 */
  word-wrap: break-word;     /* 长词语换行 */
  overflow-wrap: break-word; /* 兼容属性 */

  min-height: auto;          /* 让高度自动撑开 */
  height: auto;
}
    .knowledge-item:hover {
      filter: brightness(1.1);
    }

    /* 弹出层背景虚化 */
    #overlay {
      position: fixed;
      top: 0; left: 0; right:0; bottom: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    /* 弹出框主体 */
    #popup {
      background: #bddbe9;
      border-radius: 10px;
      max-width: 600px;
      max-height: 80vh;
      width: 90%;
      padding: 20px 30px;
      box-sizing: border-box;
      position: relative;
      display: flex;
      flex-direction: column;
      user-select: text;
    }

    /* 内容文字 */
    #popup-content {
      flex: 1;
      overflow-y: auto;
      font-size: 1.1em;
      line-height: 1.5em;
      color: #222;
      margin-bottom: 20px;
    }

    /* 标题 */
    #popup-title {
      font-weight: 700;
      margin-bottom: 12px;
      font-size: 1.3em;
      color: #111;
    }

    /* 关闭按钮 */
    #close-btn {
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 20px;
      cursor: pointer;
      border: none;
      background: none;
      color: #666;
      transition: color 0.2s ease;
    }
    #close-btn:hover {
      color: #000;
    }

    /* 左右箭头按钮 */
    .nav-btn {
      cursor: pointer;
      user-select: none;
      font-size: 2em;
      font-weight: bold;
      color: #666;
      padding: 0 12px;
      align-self: center;
      transition: color 0.2s ease;
      user-select:none;
      background: none;
      border: none;
    }
    .nav-btn:hover {
      color: #000;
    }

    /* 弹出框底部导航 */
    #popup-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <div id="container">
    <!-- 动态填充知识点块 -->
  </div>

  <div id="overlay">
    <div id="popup">
      <button id="close-btn" title="关闭">&times;</button>
      <div id="popup-title"></div>
      <div id="popup-content"></div>
      <div id="popup-nav">
        <button id="prev-btn" class="nav-btn" title="上一条">&#8592;</button>
        <button id="next-btn" class="nav-btn" title="下一条">&#8594;</button>
      </div>
    </div>
  </div>

<script>
  // 颜色class索引（对应css中.category-0/.category-1/.category-2...）
  const categoryColors = ['category-0', 'category-1', 'category-2', 'category-3', 'category-4'];

  let knowledgeData = null; // 存放json数据
  let currentCategory = null; // 当前弹出详细页的大类名
  let currentKeys = [];      // 当前大类所有知识点ID列表（字符串数组）
  let currentIndex = 0;      // 当前大类知识点索引

  // DOM元素引用
  const container = document.getElementById('container');
  const overlay = document.getElementById('overlay');
  const popupTitle = document.getElementById('popup-title');
  const popupContent = document.getElementById('popup-content');
  const closeBtn = document.getElementById('close-btn');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');

  // 从json文件加载数据
  async function loadData() {
    try {
      const resp = await fetch('knowledge.json');
      knowledgeData = await resp.json();
      renderList();
    } catch (e) {
      container.innerHTML = `<p style="color:red;">加载数据失败: ${e.message}</p>`;
    }
  }

  // 渲染知识点列表
  function renderList() {
    container.innerHTML = '';
    const categories = Object.keys(knowledgeData);
    categories.forEach((cat, i) => {
      // 大类标题
      const catTitle = document.createElement('div');
      catTitle.className = 'category-title';
      catTitle.textContent = cat;
      container.appendChild(catTitle);

      // 大类容器，用颜色区分
      const catDiv = document.createElement('div');
      catDiv.className = categoryColors[i % categoryColors.length];
      container.appendChild(catDiv);

      // 逐条知识点显示块
      const points = knowledgeData[cat];
      // keys排序，保证数字顺序
      const sortedKeys = Object.keys(points).sort((a,b) => +a - +b);
      sortedKeys.forEach(key => {
        const item = document.createElement('div');
        item.className = 'knowledge-item';
        item.textContent = points[key].length > 30 ? points[key].slice(0, 30) + '…' : points[key]; // 显示简短内容
        item.title = points[key]; // 鼠标悬浮显示全文
        item.dataset.category = cat;
        item.dataset.key = key;
        // 点击打开详细页
        item.addEventListener('click', () => openPopup(cat, sortedKeys, key));
        catDiv.appendChild(item);
      });
    });
  }

  // 打开弹出详细页
  function openPopup(category, keys, key) {
    currentCategory = category;
    currentKeys = keys;
    currentIndex = keys.indexOf(key);

    showDetail();
    overlay.style.display = 'flex';
    document.body.style.overflow = 'hidden'; // 禁止背景滚动
  }

  // 关闭弹出详细页
  function closePopup() {
    overlay.style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  // 显示当前知识点详细内容
  function showDetail() {
    const key = currentKeys[currentIndex];
    const content = knowledgeData[currentCategory][key];
    popupTitle.textContent = `${currentCategory} #${key}`;
    popupContent.textContent = content;

    // 按钮禁用控制
    prevBtn.disabled = currentIndex <= 0;
    nextBtn.disabled = currentIndex >= currentKeys.length - 1;
  }

  // 切换上一条
  function prevItem() {
    if (currentIndex > 0) {
      currentIndex--;
      showDetail();
    }
  }

  // 切换下一条
  function nextItem() {
    if (currentIndex < currentKeys.length - 1) {
      currentIndex++;
      showDetail();
    }
  }

  // 事件绑定
  closeBtn.addEventListener('click', closePopup);
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) closePopup();
  });
  prevBtn.addEventListener('click', prevItem);
  nextBtn.addEventListener('click', nextItem);

  // 页面加载时调用
  window.addEventListener('DOMContentLoaded', loadData);
</script>